"use strict";(("undefined"!==typeof self?self:this)["webpackChunkmap"]=("undefined"!==typeof self?self:this)["webpackChunkmap"]||[]).push([[921],{9019:function(t,e,i){i.d(e,{Z:function(){return u}});var o=function(){var t=this,e=t._self._c;return t.isGroup?e("MapButton",t._g(t._b({attrs:{active:t.active,elevation:"0",fab:"",height:t.groupSize,text:"",title:t.tooltip||t.title,width:t.groupSize}},"MapButton",t.$attrs,!1),t.$listeners),[t._t("default",(function(){return[e("MapIcon",[t._v(" "+t._s(t.icon)+" ")])]}))],2):e("div",{staticClass:"button-container"},[e("div",{attrs:{title:t.tooltip||t.title}},[t._t("default",(function(){return[e("MapButton",t._g(t._b({staticClass:"button-elevation",attrs:{height:t.size,loading:t.loading,width:t.size}},"MapButton",t.$attrs,!1),t.$listeners),[t._t("default",(function(){return[e("MapIcon",[t._v(" "+t._s(t.icon)+" ")])]}))],2)]}))],2)])},n=[],a=i(1875),r=i(7121),s={components:{MapButton:a.Z,MapIcon:r.Z},props:{icon:{type:String},tooltip:String,title:String,loading:Boolean,size:{type:Number,default:32},active:Boolean},inject:{isGroup:{default:!1},groupSize:{default:0,from:"size"}},computed:{}},l=s,c=i(1001),d=(0,c.Z)(l,o,n,!1,null,"6efba1d6",null),u=d.exports},4921:function(t,e,i){i.r(e),i.d(e,{default:function(){return m}});var o=function(){var t=this,e=t._self._c;return e("ModuleContainer",t._b({scopedSlots:t._u([{key:"btn",fn:function(){return[e("MapControlButton",{attrs:{disabled:t.disable,icon:t.iconGeolocate,tooltip:t.tooltipGeolocate},on:{click:t.onClick}})]},proxy:!0}])},"ModuleContainer",t.bindModule,!1),[t._t("default")],2)},n=[],a=i(7349),r=i(7444),s=i(7205),l=i(9019),c={components:{MapControlButton:l.Z},mixins:[a.Z],data:()=>({p_dotElement:null,p_circleElement:null,p_userLocationDotMarker:null,bindedOnZoomLayer:null,center:[],disable:!1,active:!1,p_accuracy:0}),computed:{iconGeolocate(){return this.disable?"mdi-crosshairs-off":"mdi-crosshairs-gps"},tooltipGeolocate(){return this.disable?this.trans("map.action.geolocate-control-location-not-available"):this.trans("map.action.geolocate-control-find-my-location")}},methods:{async onClick(){this.disable=!1,this.active?(this.active=!1,this.onDestroy()):(await this.onGetLocation(),this.center.length>1&&this.map.flyTo({center:this.center,zoom:14,duration:0}))},onInit(){this.bindedOnZoomLayer=this.onZoom.bind(this)},onDestroy(){this.map.off("zoom",this.bindedOnZoomLayer),this.p_userLocationDotMarker&&this.p_userLocationDotMarker.remove(),this._accuracyCircleMarker&&this._accuracyCircleMarker.remove()},onGetLocation(){return(0,r.k$)().then((t=>{t&&(this.active=!0,this.location={lat:t.latitude,lng:t.longitude,accuracy:t.accuracy},this.p_accuracy=t.accuracy,this.center=[this.location.lng,this.location.lat],this.onAddUi(),this.map.on("zoom",this.bindedOnZoomLayer),this.$emit("update:location",this.location))})).catch((t=>{this.disable=!0,console.error(t)}))},onAddUi(){this.p_dotElement=d("div","mapboxgl-user-location"),this.p_dotElement.classList.add("mapboxgl-user-location"),this.p_dotElement.appendChild(d("div","mapboxgl-user-location-dot")),this.p_dotElement.appendChild(d("div","mapboxgl-user-location-heading")),this.p_userLocationDotMarker=new s.Marker({element:this.p_dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this.p_circleElement=d("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new s.Marker({element:this.p_circleElement,pitchAlignment:"map"}),this.p_userLocationDotMarker.setLngLat(this.center).addTo(this.map),this._accuracyCircleMarker.setLngLat(this.center).addTo(this.map),this.updateCircleRadius()},updateCircleRadius(){const t=this.map._container.getBoundingClientRect().height/2,e=this.map.unproject([0,t]),i=this.map.unproject([100,t]),o=e.distanceTo(i)/100,n=Math.ceil(2*this.p_accuracy/o);this.p_circleElement.style.width=`${n}px`,this.p_circleElement.style.height=`${n}px`},onZoom(){this.updateCircleRadius()}}};const d=function(t,e,i){const o=window.document.createElement(t);return void 0!==e&&(o.className=e),i&&i.appendChild(o),o};var u=c,p=i(1001),h=(0,p.Z)(u,o,n,!1,null,null,null),m=h.exports},7349:function(t,e,i){i.d(e,{Z:function(){return p}});i(6699);var o=i(5947),n=function(){var t=this,e=t._self._c;return e("div",{staticClass:"module__container"},[t.controlVisible&&t.$slots["btn"]?e("portal",{attrs:{order:t.order,to:t.btnTo}},[e("div",[t._t("btn")],2)]):t._e(),t._t("default"),e("portal",{attrs:{to:t.draggableTo}},[t._t("draggable",null,null,t.bindDrag)],2)],2)},a=[],r=i(6128),s={components:{Portal:r.h_},props:{prefix:{type:String,default:"mapbox"},btnWidth:{type:Number,default:32},position:{type:String,default:"bottom-right",validator(t){return-1!==["top-left","top-right","bottom-left","bottom-right"].indexOf(t)}},controlVisible:{type:Boolean,default:!0},order:{type:Number,default:0}},computed:{btnTo(){return`${this.position}-${this.prefix}`},draggableTo(){return`map-draggable-${this.prefix}`},bindDrag(){let t={};return this.position.includes("left")&&(t.left=18+this.btnWidth),this.position.includes("right")&&(t.right=18+this.btnWidth),this.position.includes("top")&&(t.top=10),this.position.includes("bottom")&&(t.bottom=10),t}}},l=s,c=i(1001),d=(0,c.Z)(l,n,a,!1,null,"beabf37e",null),u=d.exports,p={components:{ModuleContainer:u},props:{position:{type:String,default:"bottom-right",validator(t){return-1!==["top-left","top-right","bottom-left","bottom-right"].indexOf(t)}},controlVisible:{type:Boolean,default:!0},order:{type:Number,default:0}},data(){return{loaded:!1}},watch:{},inject:["getMap","mapId","trans"],computed:{isLeft(){return this.position.includes("left")},isRight(){return this.position.includes("right")},isTop(){return this.position.includes("top")},isBottom(){return this.position.includes("bottom")},bindModule(){return{controlVisible:this.controlVisible,order:this.order,position:this.position,prefix:this.mapId}}},mounted(){this.$once("module-loaded",(()=>{this.loaded=!0})),this.$on("module-failed",(()=>{this.loaded=!1})),this.getMap((async t=>{if(this.map=t,this.onInit instanceof Function){const t=this.onInit();if(t instanceof Promise)try{await t}catch(e){throw this.$emit("module-failed"),e}}this.$emit("module-loaded")}))},destroyed(){if(this.onDestroy instanceof Function)try{this.onDestroy()}catch(t){console.error(t)}this.map=null},methods:{removeListenerMap(t,e){(0,o.sq)(this.mapId,t,e)},addListenerMap(t,e,i){(0,o.bb)(this.mapId,t,e,i)},actionAfterMapLoaded(t){if(!this.map)return this.$once("module-loaded",(()=>{t()}));t()},removeSource(t){this.map.getSource(t)&&this.map.removeSource(t)},addLayer(t,e){if(!this.map)return this.$once("module-loaded",(()=>{this.addLayer(t,e)}));this.map.addLayer(t,e)},removeLayer(t){this.map&&(this.map.getLayer(t)&&this.map.removeLayer(t),this.map.getSource(t)&&this.map.removeSource(t))}}}}}]);
//# sourceMappingURL=map.umd.min.921.js.map